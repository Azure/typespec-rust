// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
//
// Code generated by Microsoft (R) Rust Code Generator. DO NOT EDIT.

use super::Metadata;
use azure_core::{
    http::{
        headers::{HeaderName, Headers},
        Response,
    },
    Result,
};
use std::collections::HashMap;

const META: &str = "x-ms-meta-";
const REQUEST_ID: HeaderName = HeaderName::from_static("x-ms-request-id");

/// Provides access to typed response headers for [`DocTestsClient::get_metadata()`](crate::generated::clients::DocTestsClient::get_metadata())
///
/// # Examples
///
/// ```no_run
/// use azure_core::{Result, http::Response};
/// use doc_tests::models::{Metadata, MetadataHeaders};
/// async fn example() -> Result<()> {
///     let response: Response<Metadata> = unimplemented!();
///     // Access response headers
///     println!("x-ms-meta: {:?}", response.metadata()?);
///     if let Some(request_id) = response.request_id()? {
///         println!("x-ms-request-id: {:?}", request_id);
///     }
///     Ok(())
/// }
/// ```
pub trait MetadataHeaders: private::Sealed {
    fn metadata(&self) -> Result<HashMap<String, String>>;
    fn request_id(&self) -> Result<Option<String>>;
}

impl MetadataHeaders for Response<Metadata> {
    fn metadata(&self) -> Result<HashMap<String, String>> {
        let mut values = HashMap::new();
        for h in self.headers().iter() {
            let name = h.0.as_str();
            if name.len() > META.len() && name.starts_with(META) {
                values.insert(name[META.len()..].to_owned(), h.1.as_str().to_owned());
            }
        }
        Ok(values)
    }

    /// An opaque, globally-unique, server-generated string identifier for the request.
    fn request_id(&self) -> Result<Option<String>> {
        Headers::get_optional_as(self.headers(), &REQUEST_ID)
    }
}

mod private {
    use super::Metadata;
    use azure_core::http::Response;

    pub trait Sealed {}

    impl Sealed for Response<Metadata> {}
}
