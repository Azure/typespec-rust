steps:
  - script: |
      pnpm install
      pnpm build
    displayName: "Build Emitter Sources"
    workingDirectory: $(TypeSpecRustPkgDir)

  - script: |
      pnpm run eslint
    displayName: "Run Lint"
    workingDirectory: $(TypeSpecRustPkgDir)

  - script: pnpm run test-ci
    displayName: Run TypeScript Tests
    workingDirectory: $(TypeSpecRustPkgDir)

  - task: PublishTestResults@2
    inputs:
      testRunner: JUnit
      testResultsFiles: $(TypeSpecRustPkgDir)/test-results.xml
      failTaskOnFailedTests: true

  - script: pnpm run merge-coverage
    displayName: Merge code coverage
    workingDirectory: $(TypeSpecRustPkgDir)

  - task: PublishCodeCoverageResults@2
    inputs:
      summaryFileLocation: $(TypeSpecRustPkgDir)/coverage/cobertura-coverage.xml
    displayName: Publish code coverage
